!function(a,b,c){var d=1,e=3,f=["p","div","pre","form"],g=27,h=9,i=[8,9,17,18,37,38,39,40,91,46];a.emojiarea={assetsPath:"",spriteSheetPath:"",blankGifPath:"",iconSize:25,icons:{}};var j=":joy:,:kissing_heart:,:heart:,:heart_eyes:,:blush:,:grin:,:+1:,:relaxed:,:pensive:,:smile:,:sob:,:kiss:,:unamused:,:flushed:,:stuck_out_tongue_winking_eye:,:see_no_evil:,:wink:,:smiley:,:cry:,:stuck_out_tongue_closed_eyes:,:scream:,:rage:,:smirk:,:disappointed:,:sweat_smile:,:kissing_closed_eyes:,:speak_no_evil:,:relieved:,:grinning:,:yum:,:laughing:,:ok_hand:,:neutral_face:,:confused:".split(",");a.fn.emojiarea=function(b){return b=a.extend({},b),this.each(function(){var d=a(this);if("contentEditable"in c.body&&b.wysiwyg!==!1){var e=getGuid();new n(d,e,a.extend({},b))}else{var e=getGuid();new m(d,e,b)}d.attr({"data-emojiable":"converted","data-id":e,"data-type":"original-input"})})};var k={};k.restoreSelection=function(){return b.getSelection?function(a){var c=b.getSelection();c.removeAllRanges();for(var d=0,e=a.length;e>d;++d)c.addRange(a[d])}:c.selection&&c.selection.createRange?function(a){a&&a.select()}:void 0}(),k.saveSelection=function(){return b.getSelection?function(){var a=b.getSelection(),c=[];if(a.rangeCount)for(var d=0,e=a.rangeCount;e>d;++d)c.push(a.getRangeAt(d));return c}:c.selection&&c.selection.createRange?function(){var a=c.selection;return"none"!==a.type.toLowerCase()?a.createRange():null}:void 0}(),k.replaceSelection=function(){return b.getSelection?function(a){var d,e=b.getSelection(),f="string"==typeof a?c.createTextNode(a):a;e.getRangeAt&&e.rangeCount&&(d=e.getRangeAt(0),d.deleteContents(),d.insertNode(f),d.setStart(f,0),b.setTimeout(function(){d=c.createRange(),d.setStartAfter(f),d.collapse(!0),e.removeAllRanges(),e.addRange(d)},0))}:c.selection&&c.selection.createRange?function(a){var b=c.selection.createRange();"string"==typeof a?b.text=a:b.pasteHTML(a.outerHTML)}:void 0}(),k.insertAtCursor=function(a,b){a=" "+a;var d,e,f,g=b.value;"undefined"!=typeof b.selectionStart&&"undefined"!=typeof b.selectionEnd?(e=b.selectionStart,d=b.selectionEnd,b.value=g.substring(0,e)+a+g.substring(b.selectionEnd),b.selectionStart=b.selectionEnd=e+a.length):"undefined"!=typeof c.selection&&"undefined"!=typeof c.selection.createRange&&(b.focus(),f=c.selection.createRange(),f.text=a,f.select())},k.extend=function(a,b){if("undefined"!=typeof a&&a||(a={}),"object"==typeof b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},k.escapeRegex=function(a){return(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},k.htmlEntities=function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},k.emojiInserted=function(a,b){ConfigStorage.get("emojis_recent",function(b){b=b||j||[];var c=b.indexOf(a);return c?(-1!=c&&b.splice(c,1),b.unshift(a),b.length>42&&(b=b.slice(42)),void ConfigStorage.set({emojis_recent:b})):!1})};var l=function(){};l.prototype.setup=function(){var a=this;this.$editor.on("focus",function(){a.hasFocus=!0}),this.$editor.on("blur",function(){a.hasFocus=!1}),a.emojiMenu=new o(a),this.setupButton()},l.prototype.setupButton=function(){var b=this,c=a("[data-id="+this.id+"][data-type=picker]");c.on("click",function(a){b.emojiMenu.show(b)}),this.$button=c,this.$dontHideOnClick="emoji-picker"},l.createIcon=function(b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=a.emojiarea.spriteSheetPath?a.emojiarea.spriteSheetPath:a.emojiarea.assetsPath+"/emoji_spritesheet_!.png",i=a.emojiarea.blankGifPath?a.emojiarea.blankGifPath:a.emojiarea.assetsPath+"/blank.gif",j=c&&Config.Mobile?26:a.emojiarea.iconSize,l=-(j*f),m=-(j*e),n=Config.EmojiCategorySpritesheetDimens[d][1]*j,o=Config.EmojiCategorySpritesheetDimens[d][0]*j,p="display:inline-block;";return p+="width:"+j+"px;",p+="height:"+j+"px;",p+="background:url('"+h.replace("!",d)+"') "+l+"px "+m+"px no-repeat;",p+="background-size:"+n+"px "+o+"px;",'<img src="'+i+'" class="img" style="'+p+'" alt="'+k.htmlEntities(g)+'">'},a.emojiarea.createIcon=l.createIcon;var m=function(a,b,c){this.options=c,this.$textarea=a,this.$editor=a,this.id=b,this.setup()};m.prototype.insert=function(b){a.emojiarea.icons.hasOwnProperty(b)&&(k.insertAtCursor(b,this.$textarea[0]),k.emojiInserted(b,this.menu),this.$textarea.trigger("change"))},m.prototype.val=function(){return"\n"==this.$textarea?"":this.$textarea.val()},k.extend(m.prototype,l.prototype);var n=function(d,e,f){var g=this;this.options=f||{},"unicode"===a(d).attr("data-emoji-input")?this.options.inputMethod="unicode":this.options.inputMethod="image",this.id=e,this.$textarea=d,this.emojiPopup=f.emojiPopup,this.$editor=a("<div>").addClass("emoji-wysiwyg-editor").addClass(a(d)[0].className),this.$editor.data("self",this),d.attr("maxlength")&&this.$editor.attr("maxlength",d.attr("maxlength")),this.$editor.height(d.outerHeight()),this.emojiPopup.appendUnicodeAsImageToElement(this.$editor,d.val()),this.$editor.attr({"data-id":e,"data-type":"input",placeholder:d.attr("placeholder"),contenteditable:"true"});var h="blur change";this.options.norealTime||(h+=" keyup"),this.$editor.on(h,function(a){return g.onChange.apply(g,[a])}),this.$editor.on("mousedown focus",function(){c.execCommand("enableObjectResizing",!1,!1)}),this.$editor.on("blur",function(){c.execCommand("enableObjectResizing",!0,!0)});var j=this.$editor;this.$editor.on("change keydown keyup resize scroll",function(a){-1!=i.indexOf(a.which)||(a.ctrlKey||a.metaKey)&&65==a.which||(a.ctrlKey||a.metaKey)&&67==a.which||!(j.text().length+j.find("img").length>=j.attr("maxlength"))||a.preventDefault(),g.updateBodyPadding(j)}),this.$editor.on("paste",function(a){a.preventDefault();var d,e=j.attr("maxlength")-(j.text().length+j.find("img").length);(a.originalEvent||a).clipboardData?(d=(a.originalEvent||a).clipboardData.getData("text/plain"),g.options.onPaste&&(d=g.options.onPaste(d)),e<d.length&&(d=d.substring(0,e)),c.execCommand("insertText",!1,d)):b.clipboardData&&(d=b.clipboardData.getData("Text"),g.options.onPaste&&(d=g.options.onPaste(d)),e<d.length&&(d=d.substring(0,e)),c.selection.createRange().pasteHTML(d)),j.scrollTop(j[0].scrollHeight)}),d.after("<i class='emoji-picker-icon emoji-picker "+this.options.popupButtonClasses+"' data-id='"+e+"' data-type='picker'></i>"),d.hide().after(this.$editor),this.setup(),a(c.body).on("mousedown",function(){g.hasFocus&&(g.selection=k.saveSelection())})};n.prototype.updateBodyPadding=function(b){var c=a("[data-id="+this.id+"][data-type=picker]");a(b).hasScrollbar()?(c.hasClass("parent-has-scroll")||c.addClass("parent-has-scroll"),a(b).hasClass("parent-has-scroll")||a(b).addClass("parent-has-scroll")):(c.hasClass("parent-has-scroll")&&c.removeClass("parent-has-scroll"),a(b).hasClass("parent-has-scroll")&&a(b).removeClass("parent-has-scroll"))},n.prototype.onChange=function(a){var b=new CustomEvent("input",{bubbles:!0});this.$textarea.val(this.val())[0].dispatchEvent(b)},n.prototype.insert=function(b){var c="";if("unicode"==this.options.inputMethod)c=this.emojiPopup.colonToUnicode(b);else{var d=a(l.createIcon(a.emojiarea.icons[b]));d[0].attachEvent&&d[0].attachEvent("onresizestart",function(a){a.returnValue=!1},!1),c=d[0]}this.$editor.trigger("focus"),this.selection&&k.restoreSelection(this.selection);try{k.replaceSelection(c)}catch(e){}k.emojiInserted(b,this.menu),this.onChange()},n.prototype.val=function(){for(var a=[],b=[],c=this.emojiPopup,g=function(){a.push(b.join("")),b=[]},h=function(a){if(a.nodeType===e)b.push(a.nodeValue);else if(a.nodeType===d){var c=a.tagName.toLowerCase(),i=-1!==f.indexOf(c);if(i&&b.length&&g(),"img"===c){var j=a.getAttribute("alt")||"";return void(j&&b.push(j))}"br"===c&&g();for(var k=a.childNodes,l=0;l<k.length;l++)h(k[l]);i&&b.length&&g()}},i=this.$editor[0].childNodes,j=0;j<i.length;j++)h(i[j]);b.length&&g();var k=a.join("\n");return c.colonToUnicode(k)},k.extend(n.prototype,l.prototype),jQuery.fn.hasScrollbar=function(){var a=this.get(0).scrollHeight;return this.outerHeight()<a?!0:!1};var o=function(d){var e=this;e.id=d.id;var f=a(c.body);a(b);this.visible=!1,this.emojiarea=d,o.menuZIndex=5e3,this.$menu=a("<div>"),this.$menu.addClass("emoji-menu"),this.$menu.attr("data-id",e.id),this.$menu.attr("data-type","menu"),this.$menu.hide(),this.$itemsTailWrap=a('<div class="emoji-items-wrap1"></div>').appendTo(this.$menu),this.$categoryTabs=a('<table class="emoji-menu-tabs"><tr><td><a class="emoji-menu-tab icon-recent" ></a></td><td><a class="emoji-menu-tab icon-smile" ></a></td><td><a class="emoji-menu-tab icon-flower"></a></td><td><a class="emoji-menu-tab icon-bell"></a></td><td><a class="emoji-menu-tab icon-car"></a></td><td><a class="emoji-menu-tab icon-grid"></a></td></tr></table>').appendTo(this.$itemsTailWrap),this.$itemsWrap=a('<div class="emoji-items-wrap mobile_scrollable_wrap"></div>').appendTo(this.$itemsTailWrap),this.$items=a('<div class="emoji-items">').appendTo(this.$itemsWrap),this.emojiarea.$editor.after(this.$menu),f.on("keydown",function(a){(a.keyCode===g||a.keyCode===h)&&e.hide()}),f.on("message_send",function(a){e.hide()}),f.on("mouseup",function(c){c=c.originalEvent||c;var d=c.target||b;if(!a(d).hasClass(e.emojiarea.$dontHideOnClick)){for(;d&&d!=b;)if(d=d.parentNode,d==e.$menu[0]||e.emojiarea&&d==e.emojiarea.$button[0])return;e.hide()}}),this.$menu.on("mouseup","a",function(a){return a.stopPropagation(),!1}),this.$menu.on("click","a",function(c){if(e.emojiarea.updateBodyPadding(e.emojiarea.$editor),a(this).hasClass("emoji-menu-tab"))return e.getTabIndex(this)!==e.currentCategory&&e.selectCategory(e.getTabIndex(this)),!1;var d=a(".label",a(this)).text();return b.setTimeout(function(){e.onItemSelected(d),(c.ctrlKey||c.metaKey)&&e.hide()},0),c.stopPropagation(),!1}),this.selectCategory(0)};o.prototype.getTabIndex=function(a){return this.$categoryTabs.find(".emoji-menu-tab").index(a)},o.prototype.selectCategory=function(a){this.$categoryTabs.find(".emoji-menu-tab").each(function(b){b===a?this.className+="-selected":this.className=this.className.replace("-selected","")}),this.currentCategory=a,this.load(a)},o.prototype.onItemSelected=function(a){this.emojiarea.$editor.text().length+this.emojiarea.$editor.find("img").length>=this.emojiarea.$editor.attr("maxlength")||this.emojiarea.insert(a)},o.prototype.load=function(b){var c=[],d=a.emojiarea.icons,e=a.emojiarea.assetsPath,f=this;e.length&&"/"!==e.charAt(e.length-1)&&(e+="/");var g=function(){f.$items.html(c.join(""))};if(b>0){for(var h in d)d.hasOwnProperty(h)&&d[h][0]===b-1&&c.push('<a href="javascript:void(0)" title="'+k.htmlEntities(h)+'">'+l.createIcon(d[h],!0)+'<span class="label">'+k.htmlEntities(h)+"</span></a>");g()}else ConfigStorage.get("emojis_recent",function(a){a=a||j||[];var b,e;for(e=0;e<a.length;e++)b=a[e],d[b]&&c.push('<a href="javascript:void(0)" title="'+k.htmlEntities(b)+'">'+l.createIcon(d[b],!0)+'<span class="label">'+k.htmlEntities(b)+"</span></a>");g()})},o.prototype.hide=function(a){this.visible=!1,this.$menu.hide("fast")},o.prototype.show=function(b){return this.visible?this.hide():(a(this.$menu).css("z-index",++o.menuZIndex),this.$menu.show("fast"),this.currentCategory||this.load(0),void(this.visible=!0))}}(jQuery,window,document);